## 근접성 서비스

### 문제 이해 및 설계 범위 확정

- 사용자가 검색 반경을 지정할 수 있어야 하는가?
- 검색 반경 내에 표시할 사업장이 충분치 않은 경우에 검색 반경을 시스템이 알아서 넓혀도 되는가?
- 최대 허용 반경은 얼마인가? 20km로 가정해도 괜찮은가?
- 사업장 정보는 어떻게 시스템에 추가/삭제/갱신 되는가?
- 사업장 정보에 대한 작업 결과가 사용자에게 실시간으로 보여져야하는가?
- 검색 결과를 항상 현재 위치 기준으로 유지하기 위해 화면을 자동 갱신해야하는가?

### 기능 요구사항

- 사용자의 위치(경도와 위도 쌍)와 검색 반경 정보에 매치되는 사업장 목록을 반환
- 사업장 정보를 추가/삭제/갱신 할 수 있되, 실시간으로 반영될 필요는 없음
- 고객은 사업장의 상세 정보를 살필 수 있어야 함

### 비기능 요구사항

- **낮은 응답 지연:** 사용자는 주변 사업장을 신속히 검색할 수 있어야 함
- **데이터 보호:** 사용자 위치는 민감한 정보임, GDPR/CCPA 같은 데이터 사생활 보호 법안을 준수해야함
- **고가용성:** 인구 밀집 지역에서 이용자가 집중되는 시간에 트래픽이 급증해도 감당할 수 있도록 설계해야함

### 읽기/쓰기 비율

읽기 연산은 굉장히 자주 사용되지만 쓰기 연산 실행 빈도는 매우 낮음

읽기 연산이 압도적인 시스템에는 MySQL 같은 관계형 데이터베이스가 바람직함

**Why**

- 인덱스를 통해 데이터 조회 성능을 최적화 할 수 있고, 데이터 캐싱을 활용할 수 있음
- 읽기 성능이 병목이라면, 사본 데이터베이스를 증설하면됨

**지도 서비스에서는 어떤 데이터베이스를 사용할까?**

- RDB
    - PostgreSQL → PostGIS
    - MySQL → Spatical Extensions

- NoSQL
    - Redis → Geohash
    - MongoDB
    - Cassandra

- 기타
    - GeoServer

### 데이터베이스 클러스터

데이터베이스 클러스터는 주-부(primary-secondary) 데이터베이스 형태로 구성할 수 있음

주 데이터베이스는 쓰기 요청을 처리하고, 사본 데이터베이스는 읽기 요청을 처리함

주 데이터베이스에 기록된 후 사본 데이터베이스로 복제가 되는데, 딜레이가 있을 수 있음. 실시간 서비스 일 경우 문제가 생길 수 있지만, 여기서 다루는 주제에서는 실시간으로 갱신될 필요가 없기에 신경쓰지 않아도 됨

**Geohash Map →** https://geohash.softeng.co/
